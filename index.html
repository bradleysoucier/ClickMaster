<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Clicker Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #ffcc00;
        }
        
        .clicker-container {
            margin: 30px 0;
        }
        
        .click-button {
            background: linear-gradient(145deg, #ffcc00, #ff9900);
            border: none;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .click-button:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }
        
        .click-button:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .click-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .leaderboard {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .leaderboard h2 {
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .rank-1 {
            color: gold;
            font-weight: bold;
        }
        
        .rank-2 {
            color: silver;
        }
        
        .rank-3 {
            color: #cd7f32; /* bronze */
        }
        
        .footer {
            margin-top: 30px;
            padding: 15px;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .recent-clicks {
            margin-top: 20px;
            font-style: italic;
            opacity: 0.8;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .stat-box {
                min-width: 150px;
            }
            
            .click-button {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Global Clicker Game</h1>
            <p class="subtitle">Click to increase the global counter in real-time!</p>
        </header>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-label">Global Clicks</div>
                <div class="stat-value" id="global-clicks">0</div>
                <div class="stat-desc">Total clicks worldwide</div>
            </div>
            
            <div class="stat-box">
                <div class="stat-label">Your Clicks</div>
                <div class="stat-value" id="your-clicks">0</div>
                <div class="stat-desc">Your contribution</div>
            </div>
            
            <div class="stat-box">
                <div class="stat-label">Clicks Per Second</div>
                <div class="stat-value" id="clicks-per-second">0</div>
                <div class="stat-desc">Global rate</div>
            </div>
        </div>
        
        <div class="clicker-container">
            <button class="click-button" id="click-button">
                <span class="click-icon">ðŸ‘†</span>
                CLICK ME!
            </button>
            <p class="recent-clicks" id="recent-clicks">Recent clicks will appear here</p>
        </div>
        
        <div class="leaderboard">
            <h2>Top Clickers</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>User</th>
                        <th>Clicks</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <tr>
                        <td>1</td>
                        <td>Loading...</td>
                        <td>0</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <p>No login required â€¢ Real-time updates â€¢ Global community</p>
        </div>
    </div>

    <script>
        // Supabase configuration - Replace with your actual values
        const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
        
        // Initialize Supabase client
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Game state
        let yourClicks = 0;
        let globalClicks = 0;
        let clicksPerSecond = 0;
        let lastClickTime = Date.now();
        let clickHistory = [];
        
        // DOM elements
        const clickButton = document.getElementById('click-button');
        const globalClicksElement = document.getElementById('global-clicks');
        const yourClicksElement = document.getElementById('your-clicks');
        const clicksPerSecondElement = document.getElementById('clicks-per-second');
        const recentClicksElement = document.getElementById('recent-clicks');
        const leaderboardBody = document.getElementById('leaderboard-body');
        
        // Generate a unique user ID for this session
        const userId = 'user_' + Math.random().toString(36).substr(2, 9);
        
        // Function to update the global click count
        async function updateGlobalClicks() {
            try {
                // Insert a new click record
                const { data, error } = await supabase
                    .from('clicks')
                    .insert([
                        { user_id: userId }
                    ]);
                
                if (error) {
                    console.error('Error inserting click:', error);
                    return;
                }
                
                // Update local state
                yourClicks++;
                updateDisplay();
                
                // Record this click for recent clicks display
                const now = new Date();
                clickHistory.unshift({
                    time: now.toLocaleTimeString(),
                    userId: userId
                });
                
                // Keep only the last 5 clicks
                if (clickHistory.length > 5) {
                    clickHistory.pop();
                }
                
                updateRecentClicks();
                
            } catch (error) {
                console.error('Error updating global clicks:', error);
            }
        }
        
        // Function to update the display
        function updateDisplay() {
            globalClicksElement.textContent = globalClicks.toLocaleString();
            yourClicksElement.textContent = yourClicks.toLocaleString();
            clicksPerSecondElement.textContent = clicksPerSecond.toFixed(1);
        }
        
        // Function to update recent clicks display
        function updateRecentClicks() {
            if (clickHistory.length === 0) {
                recentClicksElement.textContent = "No recent clicks yet";
                return;
            }
            
            let recentText = "Recent clicks: ";
            clickHistory.forEach((click, index) => {
                if (index > 0) recentText += " â€¢ ";
                recentText += `${click.time} (${click.userId.substring(0, 6)}...)`;
            });
            
            recentClicksElement.textContent = recentText;
        }
        
        // Function to fetch the global click count
        async function fetchGlobalClicks() {
            try {
                // Get total click count
                const { count, error } = await supabase
                    .from('clicks')
                    .select('*', { count: 'exact', head: true });
                
                if (error) {
                    console.error('Error fetching global clicks:', error);
                    return;
                }
                
                globalClicks = count;
                updateDisplay();
                
            } catch (error) {
                console.error('Error fetching global clicks:', error);
            }
        }
        
        // Function to fetch clicks per second
        async function fetchClicksPerSecond() {
            try {
                // Get clicks from the last minute
                const oneMinuteAgo = new Date(Date.now() - 60000).toISOString();
                
                const { count, error } = await supabase
                    .from('clicks')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', oneMinuteAgo);
                
                if (error) {
                    console.error('Error fetching clicks per second:', error);
                    return;
                }
                
                // Calculate clicks per second (average over the last minute)
                clicksPerSecond = count / 60;
                updateDisplay();
                
            } catch (error) {
                console.error('Error fetching clicks per second:', error);
            }
        }
        
        // Function to fetch leaderboard
        async function fetchLeaderboard() {
            try {
                const { data, error } = await supabase
                    .from('user_click_counts')
                    .select('*')
                    .order('click_count', { ascending: false })
                    .limit(10);
                
                if (error) {
                    console.error('Error fetching leaderboard:', error);
                    return;
                }
                
                // Update leaderboard
                leaderboardBody.innerHTML = '';
                
                data.forEach((user, index) => {
                    const row = document.createElement('tr');
                    
                    // Add rank class for top 3
                    let rankClass = '';
                    if (index === 0) rankClass = 'rank-1';
                    else if (index === 1) rankClass = 'rank-2';
                    else if (index === 2) rankClass = 'rank-3';
                    
                    row.innerHTML = `
                        <td class="${rankClass}">${index + 1}</td>
                        <td class="${rankClass}">${user.user_id}</td>
                        <td class="${rankClass}">${user.click_count.toLocaleString()}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
            }
        }
        
        // Set up real-time subscription for clicks
        function setupRealtimeSubscription() {
            supabase
                .channel('global-clicks')
                .on('postgres_changes', 
                    { 
                        event: 'INSERT', 
                        schema: 'public', 
                        table: 'clicks' 
                    }, 
                    (payload) => {
                        // Update global click count when a new click is added
                        globalClicks++;
                        updateDisplay();
                        
                        // Add to recent clicks
                        const now = new Date();
                        clickHistory.unshift({
                            time: now.toLocaleTimeString(),
                            userId: payload.new.user_id
                        });
                        
                        // Keep only the last 5 clicks
                        if (clickHistory.length > 5) {
                            clickHistory.pop();
                        }
                        
                        updateRecentClicks();
                        
                        // Update leaderboard periodically
                        if (globalClicks % 10 === 0) {
                            fetchLeaderboard();
                        }
                    }
                )
                .subscribe();
        }
        
        // Initialize the game
        async function initGame() {
            // Fetch initial data
            await fetchGlobalClicks();
            await fetchClicksPerSecond();
            await fetchLeaderboard();
            
            // Set up real-time subscription
            setupRealtimeSubscription();
            
            // Update clicks per second periodically
            setInterval(fetchClicksPerSecond, 10000);
            
            // Update leaderboard periodically
            setInterval(fetchLeaderboard, 30000);
        }
        
        // Event listener for the click button
        clickButton.addEventListener('click', updateGlobalClicks);
        
        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
